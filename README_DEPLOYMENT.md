# ๐ ะะฐะทะฒะตัััะฒะฐะฝะธะต Excel Course ะฝะฐ Ubuntu

ะะพะปะฝัะน ะฝะฐะฑะพั ัะบัะธะฟัะพะฒ ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ัะฐะทะฒะตัััะฒะฐะฝะธั Excel Course ะฝะฐ Ubuntu ัะตัะฒะตัะต ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ Docker ะดะปั ะธะทะพะปััะธะธ ััะตะดั.

## ๐ ะขัะตะฑะพะฒะฐะฝะธั

- Ubuntu 20.04 ะธะปะธ ะฝะพะฒะตะต
- ะะธะฝะธะผัะผ 5GB ัะฒะพะฑะพะดะฝะพะณะพ ะผะตััะฐ
- ะะพะผะตะฝ `excel-edu.ru` ั ะฝะฐัััะพะตะฝะฝัะผ DNS
- ะัะฐะฒะฐ ะฐะดะผะธะฝะธัััะฐัะพัะฐ

## ๐ฏ ะััััะฐั ัััะฐะฝะพะฒะบะฐ

### 1. ะะปะพะฝะธัะพะฒะฐะฝะธะต ะฟัะพะตะบัะฐ

```bash
git clone <your-repo-url> excel-course
cd excel-course
```

### 2. ะะฐะฟััะบ ะฐะฒัะพะผะฐัะธัะตัะบะพะน ัััะฐะฝะพะฒะบะธ

```bash
sudo ./install.sh
```

ะญัะพั ัะบัะธะฟั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฒัะฟะพะปะฝะธั ะฒัะต ััะฐะฟั:
- โ ะะฑะฝะพะฒะปะตะฝะธะต ัะธััะตะผั
- โ ะฃััะฐะฝะพะฒะบั Docker ะธ ะทะฐะฒะธัะธะผะพััะตะน
- โ ะะฐัััะพะนะบั nginx ะธ firewall
- โ ะะฐะทะฒะตัััะฒะฐะฝะธะต ะฟัะธะปะพะถะตะฝะธั
- โ ะะฐัััะพะนะบั SSL ัะตััะธัะธะบะฐัะพะฒ
- โ ะะฐัััะพะนะบั ะผะพะฝะธัะพัะธะฝะณะฐ

## ๐ ะกัััะบัััะฐ ัะบัะธะฟัะพะฒ

```
excel-course/
โโโ install.sh          # ะะปะฐะฒะฝัะน ัะบัะธะฟั ัััะฐะฝะพะฒะบะธ
โโโ deploy.sh           # ะกะบัะธะฟั ัะฐะทะฒะตัััะฒะฐะฝะธั ะฟัะธะปะพะถะตะฝะธั
โโโ setup-ssl.sh        # ะะฐัััะพะนะบะฐ SSL ัะตััะธัะธะบะฐัะพะฒ
โโโ health-check.sh     # ะัะพะฒะตัะบะฐ ัะพััะพัะฝะธั ัะธััะตะผั
โโโ manage.sh           # ะฃะฟัะฐะฒะปะตะฝะธะต ะฟัะธะปะพะถะตะฝะธะตะผ (ัะพะทะดะฐะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ)
โโโ DEPLOYMENT.md       # ะะพะดัะพะฑะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั
โโโ README_DEPLOYMENT.md # ะญัะพั ัะฐะนะป
```

## ๐ง ะััะฝะฐั ัััะฐะฝะพะฒะบะฐ (ะฟะพัะฐะณะพะฒะพ)

ะัะปะธ ะฒั ัะพัะธัะต ะฒัะฟะพะปะฝะธัั ัััะฐะฝะพะฒะบั ะฟะพัะฐะณะพะฒะพ:

### 1. ะัะพะฒะตัะบะฐ ัะธััะตะผั

```bash
sudo ./install.sh --check
```

### 2. ะะฐะทะฒะตัััะฒะฐะฝะธะต ะฟัะธะปะพะถะตะฝะธั

```bash
sudo ./deploy.sh deploy
```

### 3. ะะฐัััะพะนะบะฐ SSL

```bash
sudo ./setup-ssl.sh
```

### 4. ะัะพะฒะตัะบะฐ ัะพััะพัะฝะธั

```bash
./health-check.sh
```

## ๐ฎ ะฃะฟัะฐะฒะปะตะฝะธะต ะฟัะธะปะพะถะตะฝะธะตะผ

ะะพัะปะต ัััะฐะฝะพะฒะบะธ ะดะพัััะฟะฝั ัะปะตะดัััะธะต ะบะพะผะฐะฝะดั:

### ะะปะพะฑะฐะปัะฝัะต ะบะพะผะฐะฝะดั

```bash
# ะฃะฟัะฐะฒะปะตะฝะธะต ะฟัะธะปะพะถะตะฝะธะตะผ
excel-course start      # ะะฐะฟััะบ
excel-course stop       # ะััะฐะฝะพะฒะบะฐ
excel-course restart    # ะะตัะตะทะฐะฟััะบ
excel-course status     # ะกัะฐััั
excel-course logs       # ะะพะณะธ
excel-course backup     # ะะตะทะตัะฒะฝะฐั ะบะพะฟะธั
excel-course update     # ะะฑะฝะพะฒะปะตะฝะธะต
```

### ะะพะบะฐะปัะฝัะต ะบะพะผะฐะฝะดั

```bash
# ะ ะดะธัะตะบัะพัะธะธ ะฟัะพะตะบัะฐ
./manage.sh start       # ะะฐะฟััะบ
./manage.sh stop        # ะััะฐะฝะพะฒะบะฐ
./manage.sh restart     # ะะตัะตะทะฐะฟััะบ
./manage.sh logs        # ะะพะณะธ
./manage.sh status      # ะกัะฐััั ะบะพะฝัะตะนะฝะตัะพะฒ
./manage.sh backup      # ะะตะทะตัะฒะฝะฐั ะบะพะฟะธั ะะ
./manage.sh update      # ะะฑะฝะพะฒะปะตะฝะธะต ั Git
```

## ๐ ะะพะฝะธัะพัะธะฝะณ ะธ ะดะธะฐะณะฝะพััะธะบะฐ

### ะัะพะฒะตัะบะฐ ัะพััะพัะฝะธั

```bash
# ะะพะปะฝะฐั ะฟัะพะฒะตัะบะฐ ัะธััะตะผั
./health-check.sh

# ะัะพะฒะตัะบะฐ ะพัะดะตะปัะฝัั ะบะพะผะฟะพะฝะตะฝัะพะฒ
./health-check.sh containers  # Docker ะบะพะฝัะตะนะฝะตัั
./health-check.sh database    # ะะฐะทะฐ ะดะฐะฝะฝัั
./health-check.sh nginx       # Nginx
./health-check.sh ssl         # SSL ัะตััะธัะธะบะฐัั
./health-check.sh app         # ะัะธะปะพะถะตะฝะธะต
```

### ะัะพัะผะพัั ะปะพะณะพะฒ

```bash
# ะะพะณะธ ะฟัะธะปะพะถะตะฝะธั
docker-compose logs -f app

# ะะพะณะธ ะฑะฐะทั ะดะฐะฝะฝัั
docker-compose logs -f db

# ะะพะณะธ nginx
sudo tail -f /var/log/nginx/error.log

# ะะพะณะธ ะผะพะฝะธัะพัะธะฝะณะฐ
tail -f /var/log/excel-course-health.log
```

### ะะพะฝะธัะพัะธะฝะณ ัะตััััะพะฒ

```bash
# ะัะฟะพะปัะทะพะฒะฐะฝะธะต ัะตััััะพะฒ ะบะพะฝัะตะนะฝะตัะฐะผะธ
docker stats

# ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะดะธัะบะฐ
df -h

# ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟะฐะผััะธ
free -h
```

## ๐ ะะตะทะพะฟะฐัะฝะพััั

### SSL ัะตััะธัะธะบะฐัั

```bash
# ะัะพะฒะตัะบะฐ ััะฐัััะฐ ัะตััะธัะธะบะฐัะพะฒ
sudo ./setup-ssl.sh status

# ะััะฝะพะต ะพะฑะฝะพะฒะปะตะฝะธะต
sudo ./setup-ssl.sh renew
```

### Firewall

```bash
# ะกัะฐััั firewall
sudo ufw status

# ะัะพะฒะตัะบะฐ ะพัะบััััั ะฟะพััะพะฒ
sudo netstat -tlnp
```

### Fail2ban

```bash
# ะกัะฐััั fail2ban
sudo fail2ban-client status

# ะัะพะฒะตัะบะฐ ะทะฐะฑะปะพะบะธัะพะฒะฐะฝะฝัั IP
sudo fail2ban-client status nginx-http-auth
```

## ๐พ ะะตะทะตัะฒะฝะพะต ะบะพะฟะธัะพะฒะฐะฝะธะต

### ะะฒัะพะผะฐัะธัะตัะบะพะต ัะตะทะตัะฒะฝะพะต ะบะพะฟะธัะพะฒะฐะฝะธะต

```bash
# ะะพะฑะฐะฒะปะตะฝะธะต ะฒ cron (ะตะถะตะดะฝะตะฒะฝะพ ะฒ 2:00)
(crontab -l 2>/dev/null; echo "0 2 * * * cd /opt/excel-course && ./manage.sh backup") | crontab -
```

### ะััะฝะพะต ัะตะทะตัะฒะฝะพะต ะบะพะฟะธัะพะฒะฐะฝะธะต

```bash
# ะะตะทะตัะฒะฝะฐั ะบะพะฟะธั ะฑะฐะทั ะดะฐะฝะฝัั
./manage.sh backup

# ะะตะทะตัะฒะฝะฐั ะบะพะฟะธั ัะฐะนะปะพะฒ ะทะฐะณััะทะพะบ
tar -czf uploads_backup_$(date +%Y%m%d_%H%M%S).tar.gz public/uploads/
```

## ๐ ะะฑะฝะพะฒะปะตะฝะธะต

### ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะพะฒะปะตะฝะธะต

```bash
# ะะฑะฝะพะฒะปะตะฝะธะต ั ะฟะตัะตัะฑะพัะบะพะน
./manage.sh update
```

### ะััะฝะพะต ะพะฑะฝะพะฒะปะตะฝะธะต

```bash
# ะะพะปััะตะฝะธะต ะธะทะผะตะฝะตะฝะธะน
git pull

# ะััะฐะฝะพะฒะบะฐ ะบะพะฝัะตะนะฝะตัะพะฒ
docker-compose down

# ะะตัะตัะฑะพัะบะฐ ะพะฑัะฐะทะพะฒ
docker-compose build --no-cache

# ะะฐะฟััะบ ะบะพะฝัะตะนะฝะตัะพะฒ
docker-compose up -d

# ะัะธะผะตะฝะตะฝะธะต ะผะธะณัะฐัะธะน
docker-compose exec app npx prisma migrate deploy
```

## ๐๏ธ ะฃัััะฐะฝะตะฝะธะต ะฝะตะฟะพะปะฐะดะพะบ

### ะัะพะฑะปะตะผั ั Docker

```bash
# ะัะธััะบะฐ Docker
docker system prune -a

# ะะตัะตะทะฐะฟััะบ Docker
sudo systemctl restart docker

# ะัะพะฒะตัะบะฐ ััะฐัััะฐ
sudo systemctl status docker
```

### ะัะพะฑะปะตะผั ั ะฑะฐะทะพะน ะดะฐะฝะฝัั

```bash
# ะัะพะฒะตัะบะฐ ะฟะพะดะบะปััะตะฝะธั
docker-compose exec app npx prisma db push

# ะกะฑัะพั ะฑะฐะทั ะดะฐะฝะฝัั
docker-compose exec app npx prisma migrate reset --force

# ะัะพะฒะตัะบะฐ ะปะพะณะพะฒ ะะ
docker-compose logs db
```

### ะัะพะฑะปะตะผั ั nginx

```bash
# ะัะพะฒะตัะบะฐ ะบะพะฝัะธะณััะฐัะธะธ
sudo nginx -t

# ะะตัะตะทะฐะฟััะบ nginx
sudo systemctl restart nginx

# ะัะพัะผะพัั ะปะพะณะพะฒ
sudo tail -f /var/log/nginx/error.log
```

### ะัะพะฑะปะตะผั ั SSL

```bash
# ะัะพะฒะตัะบะฐ ัะตััะธัะธะบะฐัะพะฒ
sudo certbot certificates

# ะะฑะฝะพะฒะปะตะฝะธะต ัะตััะธัะธะบะฐัะพะฒ
sudo ./setup-ssl.sh renew

# ะัะพะฒะตัะบะฐ ััะพะบะฐ ะดะตะนััะฒะธั
openssl x509 -enddate -noout -in /etc/letsencrypt/live/excel-edu.ru/fullchain.pem
```

## ๐ ะััะธัะตะบัััะฐ ัะฐะทะฒะตัััะฒะฐะฝะธั

```
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   Internet      โ    โ     Nginx       โ    โ   Docker App    โ
โ                 โโโโโโ   (Port 80/443) โโโโโโ   (Port 3001)   โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
                                                       โ
                                              โโโโโโโโโโโโโโโโโโโ
                                              โ  Docker DB      โ
                                              โ  (PostgreSQL)   โ
                                              โโโโโโโโโโโโโโโโโโโ
```

### ะะพััั

- **80**: HTTP (ัะตะดะธัะตะบั ะฝะฐ HTTPS)
- **443**: HTTPS (ะพัะฝะพะฒะฝะพะน ะดะพัััะฟ)
- **3001**: ะัะธะปะพะถะตะฝะธะต (ะปะพะบะฐะปัะฝะพ)
- **5432**: ะะฐะทะฐ ะดะฐะฝะฝัั (ัะพะปัะบะพ ะฒะฝัััะธ Docker)

### ะคะฐะนะปะพะฒะฐั ััััะบัััะฐ

```
/var/www/excel-edu.ru/
โโโ public/
โ   โโโ uploads/
โ       โโโ assignments/     # ะะฐะดะฐะฝะธั
โ       โโโ submissions/     # ะะตัะตะฝะธั ัััะดะตะฝัะพะฒ
```

## ๐ ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### ะะฟัะธะผะธะทะฐัะธั

1. **ะััะธัะพะฒะฐะฝะธะต nginx**:
   - ะกัะฐัะธัะตัะบะธะต ัะฐะนะปั: 1 ะณะพะด
   - API ะทะฐะฟัะพัั: 5 ะผะธะฝัั

2. **ะกะถะฐัะธะต**:
   - Gzip ะฒะบะปััะตะฝะพ ะดะปั ะฒัะตั ัะตะบััะพะฒัั ัะฐะนะปะพะฒ

3. **ะะพะฝะธัะพัะธะฝะณ ัะตััััะพะฒ**:
   - ะะฒัะพะผะฐัะธัะตัะบะฐั ะฟัะพะฒะตัะบะฐ ะบะฐะถะดัะต 6 ัะฐัะพะฒ
   - ะะพะณะธัะพะฒะฐะฝะธะต ะฒ `/var/log/excel-course-health.log`

## ๐ง ะะพะฝัะธะณััะฐัะธั

### ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

ะัะฝะพะฒะฝัะต ะฟะตัะตะผะตะฝะฝัะต ะฒ `.env`:

```env
DATABASE_URL=postgresql://excel_user:excel_password@db:5432/excel_course
NEXTAUTH_SECRET=your-secret-key
NEXTAUTH_URL=https://excel-edu.ru
UPLOAD_DIR=./public/uploads
MAX_FILE_SIZE=52428800
PASS_THRESHOLD_PERCENT=50
```

### Docker ะบะพะฝัะธะณััะฐัะธั

- **ะัะธะปะพะถะตะฝะธะต**: Node.js 18 Alpine
- **ะะฐะทะฐ ะดะฐะฝะฝัั**: PostgreSQL 15 Alpine
- **ะกะตัั**: ะะทะพะปะธัะพะฒะฐะฝะฝะฐั Docker ัะตัั
- **ะขะพะผะฐ**: ะะพััะพัะฝะฝะพะต ััะฐะฝะตะฝะธะต ะดะฐะฝะฝัั ะะ

## ๐ ะะพะดะดะตัะถะบะฐ

### ะะพะปะตะทะฝัะต ะบะพะผะฐะฝะดั

```bash
# ะัะพัะผะพัั ะฒัะตั ะบะพะฝัะตะนะฝะตัะพะฒ
docker ps -a

# ะัะพัะผะพัั ะพะฑัะฐะทะพะฒ
docker images

# ะัะธััะบะฐ ะฝะตะธัะฟะพะปัะทัะตะผัั ัะตััััะพะฒ
docker system prune

# ะัะพัะผะพัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะดะธัะบะฐ
docker system df

# ะัะพัะผะพัั ัะตัะตะน
docker network ls

# ะัะพัะผะพัั ัะพะผะพะฒ
docker volume ls
```

### ะะพะณะธ ะดะปั ะพัะปะฐะดะบะธ

```bash
# ะะพะณะธ ะฟัะธะปะพะถะตะฝะธั
docker-compose logs -f app

# ะะพะณะธ ะฑะฐะทั ะดะฐะฝะฝัั
docker-compose logs -f db

# ะะพะณะธ nginx
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log

# ะะพะณะธ ัะธััะตะผั
sudo journalctl -u docker
sudo journalctl -u nginx
```

## ๐ ะะพัะพะฒะพ!

ะะพัะปะต ััะฟะตัะฝะพะน ัััะฐะฝะพะฒะบะธ:

1. โ ะัะธะปะพะถะตะฝะธะต ะดะพัััะฟะฝะพ ะฟะพ ะฐะดัะตัั: **https://excel-edu.ru**
2. โ SSL ัะตััะธัะธะบะฐัั ะฝะฐัััะพะตะฝั ะฐะฒัะพะผะฐัะธัะตัะบะธ
3. โ ะะพะฝะธัะพัะธะฝะณ ัะฐะฑะพัะฐะตั ะบะฐะถะดัะต 6 ัะฐัะพะฒ
4. โ ะะตะทะตัะฒะฝะพะต ะบะพะฟะธัะพะฒะฐะฝะธะต ะฝะฐัััะพะตะฝะพ
5. โ Firewall ะทะฐัะธัะฐะตั ัะธััะตะผั

### ะะตัะฒัะต ัะฐะณะธ

1. ะัะบัะพะนัะต https://excel-edu.ru ะฒ ะฑัะฐัะทะตัะต
2. ะัะพะฒะตัััะต ััะฐััั ัะธััะตะผั: `excel-course status`
3. ะกะพะทะดะฐะนัะต ะฟะตัะฒะพะณะพ ะฐะดะผะธะฝะธัััะฐัะพัะฐ ัะตัะตะท ะธะฝัะตััะตะนั
4. ะะฐัััะพะนัะต ะผะพะดัะปะธ ะธ ััะพะบะธ

---

**๐ฏ ะฃัะฟะตัะฝะพะณะพ ัะฐะทะฒะตัััะฒะฐะฝะธั! ะะฐัะฐ ะฟะปะฐััะพัะผะฐ ะพะฑััะตะฝะธั Excel ะณะพัะพะฒะฐ ะบ ัะฐะฑะพัะต!**
